<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Member Card</title>

<style>
  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f2f2f2;
    font-family: sans-serif;
  }

  .card-wrap {
    text-align: center;
  }

  #loading {
    margin-bottom: 12px;
    opacity: 0.7;
    transition: opacity .4s ease;
  }

  .card {
    position: relative;
    width: 360px;
    max-width: 90vw;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 14px 32px rgba(0,0,0,.15);
    filter: blur(8px);
    opacity: .6;
    transition: all .5s ease;
  }

  .card.loaded {
    filter: blur(0);
    opacity: 1;
  }

  .card img {
    width: 100%;
    display: block;
  }

  .field {
    position: absolute;
    left: 140px;
    color: #222;
    font-size: 16px;
    font-weight: bold;
    opacity: 0;
    transform: translateY(6px);
    transition: all .4s ease;
  }

  .field.show {
    opacity: 1;
    transform: translateY(0);
  }

  /* üîß ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  .name   { top: 73.5px; }
  .join   { top: 108px; }
  .expire { top: 145px; }

  .status {
    position: absolute;
    top: 35px;
    right: 20px;
    padding: 4px 10px;
    font-size: 12px;
    border-radius: 20px;
    color: #fff;
    font-weight: bold;
    opacity: 0;
    transition: opacity .4s ease;
  }

  .status.active  { background: #22c55e; }
  .status.expired { background: #ef4444; }
  .status.show    { opacity: 1; }
</style>
</head>

<body>

<div class="card-wrap">
  <div id="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

  <div class="card" id="card">
    <img src="card.png">
    <div id="status" class="status"></div>
    <div id="name" class="field name"></div>
    <div id="join" class="field join"></div>
    <div id="expire" class="field expire"></div>
  </div>
</div>

<script>
/* ===============================
   CONFIG
================================ */
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTH3k49gzRtNcKd8E32h5hz0rWkh3wKUkkPymfAh4NDtg0YZogVaCIV2YH8Ly68Gqhx7Fw6f4_UlGRj/pub?output=csv";

/* ===============================
   HELPERS
================================ */
function parseDateSafe(value) {
  if (!value) return null;
  const clean = value.replace(/"/g, "").trim();
  const d = new Date(clean + "T00:00:00");
  return isNaN(d) ? null : d;
}

/* ===============================
   MAIN
================================ */
const params = new URLSearchParams(window.location.search);
const memberId = params.get("id");

if (!memberId) {
  document.body.innerHTML = "<h2>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>";
} else {
  fetch(csvUrl)
    .then(r => r.text())
    .then(text => {

      const rows = text
        .trim()
        .split("\n")
        .map(r => r.split(",").map(c => c.trim()));

      const headers = rows[0].map(h => h.toLowerCase());
      const data = rows.slice(1);

      const idIndex     = headers.indexOf("id");
      const nameIndex   = headers.indexOf("name");
      const joinIndex   = headers.indexOf("join_date");
      const expireIndex = headers.indexOf("expire_date");

      const member = data.find(row => {
        const sheetId = row[idIndex].toString().padStart(3, "0");
        return sheetId === memberId;
      });

      if (!member) {
        document.body.innerHTML = "<h2>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>";
        return;
      }

      const nameEl   = document.getElementById("name");
      const joinEl   = document.getElementById("join");
      const expireEl = document.getElementById("expire");
      const card     = document.getElementById("card");
      const status   = document.getElementById("status");

      nameEl.innerText   = member[nameIndex];
      joinEl.innerText   = "‡∏™‡∏°‡∏±‡∏Ñ‡∏£: " + member[joinIndex];
      expireEl.innerText = "‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: " + member[expireIndex];

      const today = new Date();
      const expireDate = parseDateSafe(member[expireIndex]);

      if (expireDate && expireDate >= today) {
        status.innerText = "ACTIVE";
        status.className = "status active show";
      } else {
        status.innerText = "EXPIRED";
        status.className = "status expired show";
      }

      document.getElementById("loading").style.opacity = 0;

      setTimeout(() => {
        card.classList.add("loaded");
        document.querySelectorAll(".field")
          .forEach(el => el.classList.add("show"));
      }, 300);
    });
}
</script>

</body>
</html>
