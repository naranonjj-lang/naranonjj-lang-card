<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Member Card</title>

  <style>
    /* ===== Page ===== */
    body {
      margin: 0;
      padding: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f5f5f5;
      font-family: sans-serif;
    }

    /* ===== Card ===== */
    .card {
      position: relative;
      width: 100%;
      max-width: 380px;        /* ‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      transition: filter 0.4s ease;
    }

    .card img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* blur ‡∏ï‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î */
    .card.loading-state img {
      filter: blur(3px) brightness(0.9);
    }

    /* ===== Text (‡∏•‡πá‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á) ===== */
    .field {
      position: absolute;
      left: 120px;     /* üîí ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏à‡∏≤‡∏Å‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå */
      font-size: 16px; /* üîí ‡πÑ‡∏°‡πà responsive */
      font-weight: bold;
      color: #222;
    }

    .name   { top: 58px; }
    .join   { top: 88px; }
    .expire { top: 120px; }

    /* ===== Loading overlay ===== */
    .loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.85);
      font-size: 14px;
      z-index: 5;
      opacity: 1;
      transition: opacity 0.4s ease;
    }

    .loading.hide {
      opacity: 0;
      pointer-events: none;
    }

    /* ===== Fade animation ===== */
    .fade {
      opacity: 0;
      transform: translateY(6px);
      transition: all 0.4s ease;
    }

    .fade.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>

<body>

  <div class="card loading-state">
    <div id="loading" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

    <img src="card.png" alt="Member Card">

    <div id="name" class="field name fade"></div>
    <div id="join" class="field join fade"></div>
    <div id="expire" class="field expire fade"></div>
  </div>

  <script>
    const csvUrl =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTH3k49gzRtNcKd8E32h5hz0rWkh3wKUkkPymfAh4NDtg0YZogVaCIV2YH8Ly68Gqhx7Fw6f4_UlGRj/pub?output=csv";

    const params = new URLSearchParams(window.location.search);
    const memberId = params.get("id");

    if (!memberId) {
      document.body.innerHTML = "<h2>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>";
    } else {
      fetch(csvUrl)
        .then(res => res.text())
        .then(text => {
          const rows = text.trim().split("\n").map(r => r.split(","));
          const headers = rows[0].map(h => h.toLowerCase());
          const data = rows.slice(1);

          const idIndex     = headers.findIndex(h => h.includes("id"));
          const nameIndex   = headers.findIndex(h => h.includes("name"));
          const joinIndex   = headers.findIndex(h => h.includes("join"));
          const expireIndex = headers.findIndex(h => h.includes("expire"));

          const member = data.find(r => r[idIndex] === memberId);

          if (!member) {
            document.body.innerHTML = "<h2>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>";
            return;
          }

          document.getElementById("name").innerText   = member[nameIndex];
          document.getElementById("join").innerText   = "‡∏™‡∏°‡∏±‡∏Ñ‡∏£: " + member[joinIndex];
          document.getElementById("expire").innerText = "‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏: " + member[expireIndex];

          const loadingEl = document.getElementById("loading");
          const cardEl = document.querySelector(".card");

          loadingEl.classList.add("hide");
          cardEl.classList.remove("loading-state");

          document.querySelectorAll(".fade").forEach((el, i) => {
            setTimeout(() => el.classList.add("show"), 120 + i * 120);
          });
        });
    }
  </script>

</body>
</html>
